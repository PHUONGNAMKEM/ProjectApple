<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home Page</title>
    <link rel="stylesheet" href="/css/sharing.css">
    <link rel="stylesheet" href="/css/home.css">
    <link rel="stylesheet" href="/css/grid.css">
    <link rel="stylesheet" href="/css/edit.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

</head>

<script>
    // 1. đảm bảo chỉ chạy sau khi HTML được load xong
    // 2. chỉ định sự kiện click của nút btnDelete 
    // 3. lấy ra id của nút đó thông qua thuộc tính data-id
    // 4. kiểm tra nếu muốn xóa user với id = ${id} 
    // 5. $ajax({url:window.location.origin/route, method:, success:closest().remove(), error: function console lỗi})
    // giải thích từng câu lệnh trong file C:\Users\Lenovo\Downloads\NodeJS\Install\crud-be của máy tính

    $(document).ready(function () {
        $(".btnDelete").click(function () {
            const id = $(this).attr("data-id");
            if (confirm(`Are you sure to delete this user, id = ${id}`)) {
                // cách 1 là truyền id thông qua biến nên có thể truy cập bằng req.params
                // $.ajax({
                //     url: `${window.location.origin}/delete-user-ajax/${id}`,
                //     method: "DELETE",
                //     success: (result) => {
                //         $(this).closest("tr").remove();
                //     },
                //     error: function (error) {
                //         console.log("Ajax error: ", error);
                //     }
                // });

                // cách ajax thứ 2: dùng req.body bên controller do method DELETE không dùng biến trên url (req.params) được, nên sẽ truyền qua tham số data:
                // (và lưu ý route của cách 2 này không cần phải /${id} )
                $.ajax({
                    url: `${window.location.origin}/delete-user-ajax`,
                    method: "POST",
                    data: { userId: id }, // Gửi userId qua body
                    success: (result) => {
                        if (result.success) {
                            $(this).closest("tr").remove(); // Xóa dòng user
                        }
                    },
                    error: function (error) {
                        console.log("Ajax error: ", error);
                    }
                });

            }
            else {
                // Do nothing!
            }
        })
    });
</script>

<body>
    <div class="app">
        <header class="header">
            <div class="grid wide">
                <div class="button-container">
                    <a class="button" href="/iFanIT" id="apple">
                        <svg height="44" viewBox="0 0 14 44" width="14" xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="m13.0729 17.6825a3.61 3.61 0 0 0 -1.7248 3.0365 3.5132 3.5132 0 0 0 2.1379 3.2223 8.394 8.394 0 0 1 -1.0948 2.2618c-.6816.9812-1.3943 1.9623-2.4787 1.9623s-1.3633-.63-2.613-.63c-1.2187 0-1.6525.6507-2.644.6507s-1.6834-.9089-2.4787-2.0243a9.7842 9.7842 0 0 1 -1.6628-5.2776c0-3.0984 2.014-4.7405 3.9969-4.7405 1.0535 0 1.9314.6919 2.5924.6919.63 0 1.6112-.7333 2.8092-.7333a3.7579 3.7579 0 0 1 3.1604 1.5802zm-3.7284-2.8918a3.5615 3.5615 0 0 0 .8469-2.22 1.5353 1.5353 0 0 0 -.031-.32 3.5686 3.5686 0 0 0 -2.3445 1.2084 3.4629 3.4629 0 0 0 -.8779 2.1585 1.419 1.419 0 0 0 .031.2892 1.19 1.19 0 0 0 .2169.0207 3.0935 3.0935 0 0 0 2.1586-1.1368z">
                            </path>
                        </svg>
                    </a>
                    <a class="button" href="/search" id="search">
                        <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" aria-hidden="true"
                            viewBox="0 0 24 24" stroke-width="2" fill="none" stroke="currentColor" class="icon">
                            <path d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" stroke-linejoin="round"
                                stroke-linecap="round">
                            </path>
                        </svg>
                    </a>
                    <a class="button" href="/create" id="user">
                        <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"
                            stroke-width="0" fill="currentColor" stroke="currentColor" class="icon">
                            <path
                                d="M12 2.5a5.5 5.5 0 0 1 3.096 10.047 9.005 9.005 0 0 1 5.9 8.181.75.75 0 1 1-1.499.044 7.5 7.5 0 0 0-14.993 0 .75.75 0 0 1-1.5-.045 9.005 9.005 0 0 1 5.9-8.18A5.5 5.5 0 0 1 12 2.5ZM8 8a4 4 0 1 0 8 0 4 4 0 0 0-8 0Z">
                            </path>
                        </svg>
                    </a>
                    <a class="button" href="/cart" id="cart">
                        <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" stroke-linejoin="round"
                            stroke-linecap="round" viewBox="0 0 24 24" stroke-width="2" fill="none"
                            stroke="currentColor" class="icon">
                            <circle r="1" cy="21" cx="9"></circle>
                            <circle r="1" cy="21" cx="20"></circle>
                            <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
                        </svg>
                    </a>
                    <a class="button" href="/" id="home">
                        <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 1024 1024"
                            stroke-width="0" fill="currentColor" stroke="currentColor" class="icon">
                            <path
                                d="M946.5 505L560.1 118.8l-25.9-25.9a31.5 31.5 0 0 0-44.4 0L77.5 505a63.9 63.9 0 0 0-18.8 46c.4 35.2 29.7 63.3 64.9 63.3h42.5V940h691.8V614.3h43.4c17.1 0 33.2-6.7 45.3-18.8a63.6 63.6 0 0 0 18.7-45.3c0-17-6.7-33.1-18.8-45.2zM568 868H456V664h112v204zm217.9-325.7V868H632V640c0-22.1-17.9-40-40-40H432c-22.1 0-40 17.9-40 40v228H238.1V542.3h-96l370-369.7 23.1 23.1L882 542.3h-96.1z">
                            </path>
                        </svg>
                    </a>
                </div>
            </div>
        </header>
        <div class="app__container" style="background-color: transparent;">
            <div class="grid wide">
                <!-- <video style="width: 1000px;
                height: 958px;
                clip-path: inset(1px);" autoplay muted loop>
                    <source src="./images/video_homepage.mp4" type="video/mp4">
                </video> -->
                <!-- <video id="hero-video" autoplay="" loop="" data-inline-media="" muted="" disablepictureinpicture=""
                    preload="auto" data-inline-media-plugins="PlayPauseButton" data-load-timeout="5000"
                    data-inline-media-basepath="/105/media/us/apple-events/2024/de49429c-da1f-446d-8280-ebc5c3830b40/anim/teaser"
                    aria-label="The Apple logo, defined by an outline of solid white light and filled with vibrant shades of pink, blue, and orange. The logo multiplies, spinning and turning into pink, blue, and orange light beams. The streams of light twist, turn, roll over, and spiral, merging into overlapping gradients of pink as they transform back into the Apple logo."
                    role="img" playsinline=""
                    src="https://www.apple.com/105/media/us/apple-events/2024/de49429c-da1f-446d-8280-ebc5c3830b40/anim/teaser/large.mp4">
                </video> -->

                <div class="table-container">
                    <div class="title">List User</div>
                    <table>
                        <tr>
                            <th>Id</th>
                            <th>Full Name</th>
                            <th>Email</th>
                            <th>Phone</th>
                            <th>Address</th>
                            <th>Role</th>
                            <th>Action</th>
                        </tr>
                        <!-- <% for (var i=0; i < listUsers.length; i++) { %>
                            <tr>
                                <td>
                                    <%= listUsers[i].fullname %>
                                </td>
                                <td>
                                    <%= listUsers[i].email %>
                                </td>
                                <td>
                                    <%= listUsers[i].password %>
                                </td>
                                <td>
                                    <%= listUsers[i].phone %>
                                </td>
                                <td>
                                    <%= listUsers[i].address %>
                                </td>
                                <td>
                                    <%= listUsers[i].role %>
                                </td>
                                <td>
                                    <button>Edit</button>
                                    <button>Delete</button>
                                </td>

                            </tr>
                            <% } %> -->

                        <% listUsers.forEach(function(user) {%>
                            <tr>
                                <td>
                                    <%= user.id %>
                                </td>
                                <td>
                                    <%= user.fullname %>
                                </td>
                                <td>
                                    <%= user.email %>
                                </td>
                                <td>
                                    <%= user.phone %>
                                </td>
                                <td>
                                    <%= user.address %>
                                </td>
                                <td>
                                    <%= user.role %>
                                </td>
                                <td>
                                    <a href="/update/<%= user.id %>">Edit</a>

                                    <form action="/delete-user/<%= user.id %>" method="POST">
                                        <button>Delete</button>
                                        <span style="font-size: 10px; color: rgb(237, 93, 93)">(không dùng Ajax - sẽ bị
                                            load lại trang)</span>
                                    </form>

                                    <button class="btnDelete" data-id="<%= user.id %>">Delete</button>
                                    <span style="font-size: 10px; color: rgb(20, 213, 159)">(có dùng Ajax)</span>
                                </td>

                            </tr>
                            <% }); %>
                    </table>
                </div>



            </div>
        </div>
        <div class="footer"></div>
    </div>

</body>
<script src="./js/home.js"></script>

</html>